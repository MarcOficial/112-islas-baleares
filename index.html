<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>112 Islas Baleares</title>
<link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEA69X_qWWBU-3O3PcgrumqVEJoVA4dXWhIw&s" />
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-900 via-slate-900 to-red-900">
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;

const Phone=()=><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>;
const MapPin=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>;
const User=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
const Send=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;
const LogIn=()=><svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>;
const Shield=()=><svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
const Clock=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;

function Emergency112(){
const [formData,setFormData]=useState({servicio:'',incidente:'',ciudadano:'',ubicacion:'',nivel:10});
const [isSubmitting,setIsSubmitting]=useState(false);
const [notification,setNotification]=useState({show:false,message:'',type:''});
const [discordUser,setDiscordUser]=useState(null);
const [isLoadingUser,setIsLoadingUser]=useState(true);
const [currentTime,setCurrentTime]=useState(new Date());

const servicios = [
  { value: 'PolicÃ­a Local', icon: 'ğŸ‘®â€â™€ï¸', emoji: 'ğŸš“', roleId: 'ROLE_ID_POLICIA_LOCAL' },
  { value: 'PolicÃ­a Nacional', icon: 'ğŸ‘®â€â™‚ï¸', emoji: 'ğŸš”', roleId: '1398228126919561216' },
  { value: 'Guardia Civil', icon: 'ğŸ›¡ï¸', emoji: 'ğŸš¨', roleId: 'ROLE_ID_GUARDIA_CIVIL' },
  { value: 'SAMU 061', icon: 'ğŸš‘', emoji: 'ğŸ¥', roleId: '1398274968705568878' },
  { value: 'Bomberos', icon: 'ğŸš’', emoji: 'ğŸ”¥', roleId: '1398274299151913061' },
  { value: 'ConservaciÃ³n', icon: 'ğŸ§°', emoji: 'âš™ï¸', roleId: 'ROLE_ID_CONSERVACION' }
];

const getPrioridad = (n) => {
  if (n <= 4) return { label: 'MUY BAJA', icon: 'ğŸŸ¢', colorHex: 0x10b981, bg: 'from-green-400 to-green-600', text: 'text-green-400' };
  if (n <= 8) return { label: 'BAJA', icon: 'ğŸ’™', colorHex: 0x3b82f6, bg: 'from-blue-400 to-blue-600', text: 'text-blue-400' };
  if (n <= 12) return { label: 'MEDIA', icon: 'ğŸŸ¡', colorHex: 0xfacc15, bg: 'from-yellow-400 to-yellow-600', text: 'text-yellow-400' };
  if (n <= 16) return { label: 'ALTA', icon: 'ğŸŸ ', colorHex: 0xf97316, bg: 'from-orange-400 to-orange-600', text: 'text-orange-400' };
  return { label: 'CRÃTICA', icon: 'ğŸ”´', colorHex: 0xef4444, bg: 'from-red-500 to-red-700', text: 'text-red-500' };
};

useEffect(()=>{const timer=setInterval(()=>setCurrentTime(new Date()),1000);return()=>clearInterval(timer);},[]);
useEffect(()=>{
const token=localStorage.getItem('discord_token');
if(token){fetchDiscordUser(token);}
else{
const fragment=new URLSearchParams(window.location.hash.slice(1));
const accessToken=fragment.get('access_token');
if(accessToken){localStorage.setItem('discord_token',accessToken);fetchDiscordUser(accessToken);window.history.replaceState({},document.title,window.location.pathname);}
else{setIsLoadingUser(false);}
}},[]);

const fetchDiscordUser=async(token)=>{
try{
const response=await fetch('https://discord.com/api/users/@me',{headers:{Authorization:`Bearer ${token}`}});
if(response.ok){setDiscordUser(await response.json());}else{localStorage.removeItem('discord_token');}
}catch(error){localStorage.removeItem('discord_token');}finally{setIsLoadingUser(false);}
};

const handleDiscordLogin=()=>{window.location.href='https://discord.com/api/oauth2/authorize?client_id=1417511570124177418&response_type=token&redirect_uri=https%3A%2F%2F112-islas-baleares.vercel.app%2F&scope=identify';};
const handleLogout=()=>{localStorage.removeItem('discord_token');setDiscordUser(null);};

const handleSubmit=async()=>{
if(!discordUser){showNotification('Debe iniciar sesiÃ³n','error');return;}
if(!formData.servicio||!formData.incidente||!formData.ciudadano||!formData.ubicacion){showNotification('Complete todos los campos','error');return;}
setIsSubmitting(true);
try{
const servicio=servicios.find(s=>s.value===formData.servicio);
const prioridad=getPrioridad(formData.nivel);
const timestamp=new Date();

const embed={
author:{name:"ğŸš¨ SISTEMA 112 MALLORCA",icon_url:"https://cdn-icons-png.flaticon.com/512/3588/3588592.png"},
title:`${prioridad.icon} EMERGENCIA - PRIORIDAD ${prioridad.label}`,
description:`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘ **${servicio.emoji} ${servicio.value.toUpperCase()}** â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## ğŸ“‹ DESCRIPCIÃ“N\n\`\`\`\n${formData.incidente}\n\`\`\`\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,
color:prioridad.colorHex,
fields:[
{name:`${prioridad.icon} PRIORIDAD`,value:`\`\`\`${prioridad.label} (Nivel ${formData.nivel}/20)\`\`\``,inline:true},
{name:"âš¡ ESTADO",value:"`\`\`ACTIVA\`\`\`",inline:true},
{name:"\u200b",value:"â”â”â”â”â”â” DATOS DEL AFECTADO â”â”â”â”â”â”",inline:false},
{name:"ğŸ‘¤ CIUDADANO (IC)",value:`\`\`\`${formData.ciudadano}\`\`\``,inline:false},
{name:"ğŸ“ UBICACIÃ“N",value:`\`\`\`${formData.ubicacion}\`\`\``,inline:false},
{name:"\u200b",value:"â”â”â”â”â”â” OPERADOR â”â”â”â”â”â”",inline:false},
{name:"ğŸ‘¨â€ğŸ’¼ RESPONSABLE",value:`<@${discordUser.id}> â€¢ \`${discordUser.username}\``,inline:true},
{name:"ğŸ”’ VERIFICACIÃ“N",value:"`âœ“ CONFIRMADA`",inline:true},
{name:"\u200b",value:"\u200b",inline:false},
{name:"ğŸ“… FECHA",value:`\`${timestamp.toLocaleDateString('es-ES',{day:'2-digit',month:'long',year:'numeric'})}\``,inline:true},
{name:"â° HORA",value:`\`${timestamp.toLocaleTimeString('es-ES')}\``,inline:true},
{name:"\u200b",value:"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",inline:false},
{name:"ğŸ“Š REPORTE",value:`**ID:** \`EMG-${timestamp.getTime()}\`\n**Sistema:** 112 Mallorca v3.0`,inline:false}
],
thumbnail:{url:`https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png`},
footer:{text:"112 Mallorca â€¢ Sistema de Emergencias Â©",icon_url:"https://cdn-icons-png.flaticon.com/512/3588/3588592.png"},
timestamp:timestamp.toISOString()
};

const roleMention=`<@&${servicio.roleId}>`;

await fetch('https://discord.com/api/webhooks/1460348765671002195/daM84flVR5cQvYyXjxEeTvVSHFpXnz9R79m45EcDZj6yoZ5tgOTnmQRU_aHOWVX9VZ-x',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
content:`${roleMention}\n\nâš ï¸ **NUEVA EMERGENCIA** âš ï¸\n\n${prioridad.icon} **${prioridad.label}** (Nivel ${formData.nivel}/20)\n${servicio.emoji} **${servicio.value}**\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,
username:'Central 112 Mallorca',
avatar_url:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEA69X_qWWBU-3O3PcgrumqVEJoVA4dXWhIw&s',
embeds:[embed]
})
});

showNotification('âœ“ Emergencia reportada','success');
setFormData({servicio:'',incidente:'',ciudadano:'',ubicacion:'',nivel:10});
}catch(error){showNotification('Error de conexiÃ³n','error');}finally{setIsSubmitting(false);}
};

const showNotification=(message,type)=>{setNotification({show:true,message,type});setTimeout(()=>setNotification({show:false,message:'',type:''}),4000);};
const prioridadActual=getPrioridad(formData.nivel);

if(isLoadingUser){
return(
<div className="min-h-screen flex items-center justify-center">
<div className="text-center">
<div className="w-20 h-20 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"></div>
<p className="text-white font-bold text-lg">Cargando sistema...</p>
</div>
</div>
);
}

return(
<div className="min-h-screen px-4 py-6">
<header className="bg-white/5 backdrop-blur-lg rounded-b-3xl shadow-lg py-4 px-6 flex justify-between items-center">
<div className="flex items-center gap-4">
<div className="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg animate-pulse"><Phone/></div>
<div>
<h1 className="text-2xl font-extrabold text-white">112 Mallorca</h1>
<p className="text-sm text-blue-300 font-semibold">Sistema de Emergencias</p>
</div>
</div>
<div className="flex items-center gap-4">
<div className="flex items-center gap-2 bg-white/20 px-3 py-2 rounded-xl">
<Clock/><span className="text-white font-bold text-sm">{currentTime.toLocaleTimeString('es-ES')}</span>
</div>
{discordUser&&(
<div className="flex items-center gap-3 bg-green-500/20 px-4 py-2 rounded-xl border border-green-500/40">
<img src={`https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png`} className="w-9 h-9 rounded-full ring-2 ring-green-400"/>
<div className="hidden sm:block">
<p className="text-sm font-bold text-white">{discordUser.username}</p>
<p className="text-xs text-green-300">â— Activo</p>
</div>
<button onClick={handleLogout} className="text-xs text-white/70 hover:text-red-400 font-bold">Salir</button>
</div>
)}
</div>
</header>
<main className="max-w-7xl mx-auto mt-8 space-y-6">
{/* AquÃ­ irÃ­an las tarjetas de servicio, prioridad e incidente con nuevo estilo moderno */}
</main>
{notification.show&&(
<div className="fixed top-6 right-6 z-50">
<div className={`${notification.type==='success'?'bg-green-600':'bg-red-600'} text-white px-6 py-4 rounded-xl shadow-lg font-bold`}>
{notification.message}
</div>
</div>
)}
</div>
);
}

ReactDOM.render(React.createElement(Emergency112),document.getElementById('root'));
</script>
</body>
</html>

